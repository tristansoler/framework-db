{
  "project_id": "morningstar",
  "data_framework": {
    "core_version": "last"
  },
  "dataflows": {
    "default": {
      "processes": {
        "landing_to_raw": {
          "incoming_file": {
            "zipped": "zip",
            "file_format": "csv",
            "filename_pattern": "sample_(\\d{4})_(\\d{2})_(\\d{2})",
            "csv_specs": {
              "header_position": 0,
              "header": true,
              "encoding": "UTF-8",
              "delimiter": ";",
              "date_located": "filename",
              "date_located_filename": {
                "regex": "(\\d{4})(\\d{2})(\\d{2})"
              }
            },
            "validations": {
              "validate_extension": true,
              "validate_filename": true,
              "validate_csv": true,
              "validate_columns": true
            }
          },
          "output_file": {
            "database": "funds_raw",
            "table": "default_table"
          },
          "processing_specifications": {
            "technology": "emr",
            "hardware": {
              "ram": 512
            },
            "spark_configuration": {
              "default_catalog": true,
              "warehouse": "funds_raw"
            }
          }
        },
        "raw_to_staging": {
          "source_tables": {
            "morningstar_valuation_prod": {
              "database": "funds_raw",
              "table": "morningstar_valuation_prod",
              "primary_keys": [
                "performanceid",
                "date",
                "datadate"
              ]
            },
            "morningstar_valuation_correction": {
              "database": "funds_raw",
              "table": "morningstar_valuation_correction",
              "primary_keys": [
                "performanceid",
                "date",
                "datadate"
              ]
            }
          },
          "target_tables": {
            "morningstar_valuations": {
              "database": "funds_staging",
              "table": "morningstar_valuations",
              "primary_keys": [
                "performanceid",
                "date",
                "datadate"
              ]
            }
          },
          "processing_specifications": {
            "technology": "emr",
            "hardware": {
              "ram": 512
            },
            "spark_configuration": {
              "default_catalog": true,
              "warehouse": "funds_staging"
            }
          }
        },
        "staging_to_common": {
          "source_tables": {
            "morningstar_valuations": {
              "database": "funds_staging",
              "table": "morningstar_valuations",
              "primary_keys": [
                "performanceid",
                "date",
                "datadate"
              ]
            }
          },
          "target_tables": {
            "morningstar_valuations": {
              "database": "funds_common",
              "table": "morningstar_valuations",
              "primary_keys": [
                "performanceid",
                "date",
                "datadate"
              ]
            }
          },
          "processing_specifications": {
            "technology": "emr",
            "hardware": {
              "ram": 512
            },
            "spark_configuration": {
              "default_catalog": true,
              "warehouse": "funds_staging"
            }
          }
        }
      }
    },
    "morningstar_valuation_prod": {
      "processes": {
        "landing_to_raw": {
          "incoming_file": {
            "filename_pattern": "RTPP_REG_ROW_TYPE_VALUATION_V2_\\d{8}_PROD.ZIP",
            "filename_unzipped_pattern": "RTPP_REG_ROW_TYPE_VALUATION_V2_\\d{8}_PROD.TXT"
          },
          "output_file": {
            "table": "morningstar_valuation_prod"
          }
        },
        "raw_to_staging": {},
        "staging_to_common": {}
      }
    },
    "morningstar_valuation_correction": {
      "processes": {
        "landing_to_raw": {
          "incoming_file": {
            "filename_pattern": "RTPP_REG_ROW_TYPE_VALUATION_V2_\\d{8}_CORRECTION.ZIP",
            "filename_unzipped_pattern": "RTPP_REG_ROW_TYPE_VALUATION_V2_\\d{8}_CORRECTION.TXT"
          },
          "output_file": {
            "table": "morningstar_valuation_correction"
          }
        },
        "raw_to_staging": {},
        "staging_to_common": {}
      }
    }
  }
}