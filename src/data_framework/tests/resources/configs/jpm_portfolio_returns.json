{
    "data_framework": {
      "core_version": "last"
    },
    "dataflows": {
        "default": {
            "processes": {
              "landing_to_raw": {
                "incoming_file": {
                  "zipped": "",
                  "file_format": "csv",
                  "filename_pattern": "^LUX_RETURNS_JP_MORGAN_(\\d{4})_(\\d{2})_(\\d{2}).csv$",
                  "csv_specs": {
                    "header_position": 0,
                    "header": true,
                    "encoding": "UTF-8",
                    "delimiter": ",",
                    "date_located": "filename",
                    "date_located_filename": {
                      "regex": "(\\d{4})_(\\d{2})_(\\d{2})"
                    }
                  },
                  "validations": {
                    "validate_filename": true,
                    "validate_csv": true,
                    "validate_columns": true
                  },
                  "compare_with_previous_file": true
                },
                "output_file": {
                  "database": "funds_raw",
                  "table": "luxembourg_portfolio_returns",
                  "partition_field": "data_date"
                },
                "processing_specifications": {
                  "technology": "lambda",
                  "hardware": {
                    "ram": 512
                  }
                }
              },
              "raw_to_staging": {
                "source_tables": {
                    "lux_portfolio_returns": {
                      "database": "funds_raw",
                      "table": "luxembourg_portfolio_returns",
                      "partition_field": "data_date"
                    }
                },
                "target_tables": {
                    "lux_portfolio_returns": {
                      "database": "funds_staging",
                      "table": "luxembourg_portfolio_returns",
                      "primary_keys": [
                        "data_date"
                      ]
                    },
                    "portfolio_returns": {
                      "database": "funds_staging",
                      "table": "portfolio_returns",
                      "primary_keys": [
                        "country",
                        "account_number",
                        "base_currency",
                        "position_date",
                        "security_number_full",
                        "trading_currency"
                      ]
                    }
                },
                "processing_specifications": {
                  "technology": "emr",
                  "hardware": {
                    "ram": 512
                  },
                  "spark_configuration": {
                    "catalog": "iceberg_catalog",
                    "warehouse": "funds_staging"
                  }
                }
              },
              "staging_to_business": {
                "source_tables": {
                    "portfolio_returns": {
                      "database": "funds_staging",
                      "table": "portfolio_returns",
                      "partition_field": "data_date",
                      "primary_keys": [
                        "country",
                        "account_number",
                        "base_currency",
                        "position_date",
                        "security_number_full",
                        "trading_currency"
                      ]
                    }
                },
                "target_tables": {
                    "portfolio_functional_controls": {
                      "database": "funds_business",
                      "table": "portfolio_functional_controls",
                      "primary_keys": [
                        "country",
                        "portfolio_id",
                        "base_currency",
                        "position_date",
                        "id_control"
                      ]
                    },
                    "portfolio_returns_to_factset": {
                      "database": "funds_business",
                      "table": "portfolio_returns_to_factset",
                      "primary_keys": [
                        "date",
                        "country",
                        "portfolio",
                        "symbol"
                      ]
                    }
                },
                "processing_specifications": {
                  "technology": "emr",
                  "hardware": {
                    "ram": 512
                  },
                  "spark_configuration": {
                    "catalog": "iceberg_catalog",
                    "warehouse": "funds_staging"
                  }
                }
              },
              "to_output": {
                "output_reports": [
                  {
                    "name": "JP Morgan to Factset",
                    "source_table": {
                      "database" : "funds_business",
                      "table": "portfolio_returns_to_factset",
                      "partition_field": "date"
                    },
                    "columns": [
                      "date",
                      "country",
                      "portfolio",
                      "asset_type",
                      "symbol",
                      "security_description",
                      "shares",
                      "market_value",
                      "price_iso",
                      "price",
                      "total_return_local",
                      "total_return_base",
                      "holding_portfolio",
                      "prior_cost_base",
                      "cost_base",
                      "change_in_cost_base",
                      "prior_accrued_income_base",
                      "accrued_income_base",
                      "change_in_accrued_income_base",
                      "nominal_value",
                      "strike_price",
                      "bond_original_price",
                      "category_long_description",
                      "contract_size",
                      "coupon",
                      "gics_economic_group_description",
                      "gics_industry_group_description",
                      "gics_sector_group_description",
                      "gics_sub_sector_group_description",
                      "underlying_security",
                      "prior_trading_currency_fx_rate",
                      "exchange_rate",
                      "cusip",
                      "isin",
                      "sedol",
                      "base_currency",
                      "call_date",
                      "effective_maturity_date",
                      "expiration_date"
                    ],
                    "where": "date='{file_date}'",
                    "file_format": "csv",
                    "filename_pattern": "LUX_FACTSET_{current_date}.csv",
                    "filename_date_format": "%Y%m%d",
                    "csv_specs": {
                      "header": true,
                      "encoding": "UTF-8",
                      "delimiter": ","
                    }
                  }
                ],
                "processing_specifications": {
                    "technology": "emr",
                    "hardware": {
                      "ram": 512
                    },
                    "spark_configuration": {
                      "catalog": "iceberg_catalog",
                      "warehouse": "funds_business"
                    }
                  }
              }
            }
        },
        "jpm_portfolio_returns": {
            "processes": {
                "landing_to_raw": {},
                "raw_to_staging": {},
                "staging_to_business": {},
                "to_output": {}
            }
        }
    }
}